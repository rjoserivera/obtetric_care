{% extends 'Shared/base.html' %}
{% load static %}

{% block title %}Crear Ficha Obstétrica - Sistema Obstétrico{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            
            <!-- Encabezado -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="bi bi-file-earmark-medical-fill text-success"></i>
                    Crear Nueva Ficha Obstétrica
                </h2>
                <a href="{% url 'matrona:seleccionar_paciente_ficha' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Cancelar
                </a>
            </div>
            
            <!-- Información del Paciente -->
            <div class="card mb-4 border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-badge"></i> Información del Paciente
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>RUT:</strong> {{ paciente.persona.Rut }}</p>
                            <p class="mb-2"><strong>Nombre:</strong> 
                                {{ paciente.persona.Nombre }} 
                                {{ paciente.persona.Apellido_Paterno }} 
                                {{ paciente.persona.Apellido_Materno }}
                            </p>
                            <p class="mb-2"><strong>Edad:</strong> {{ paciente.Edad }} años</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Teléfono:</strong> {{ paciente.persona.Telefono|default:"No registrado" }}</p>
                            <p class="mb-2"><strong>Previsión:</strong> {{ paciente.get_Previcion_display }}</p>
                            <p class="mb-2"><strong>Estado Civil:</strong> {{ paciente.get_Estado_civil_display }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Formulario -->
            <form method="POST" novalidate class="needs-validation">
                {% csrf_token %}
                {{ form.paciente_id }}
                
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}
                
                <!-- Datos Básicos de la Ficha -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle"></i> Datos Básicos
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.matrona_responsable.id_for_label }}" class="form-label">
                                    {{ form.matrona_responsable.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.matrona_responsable }}
                                {% if form.matrona_responsable.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.matrona_responsable.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.nombre_acompanante.id_for_label }}" class="form-label">
                                    {{ form.nombre_acompanante.label }}
                                </label>
                                {{ form.nombre_acompanante }}
                                {% if form.nombre_acompanante.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.nombre_acompanante.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Antecedentes Obstétricos -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="bi bi-clipboard2-heart"></i> Antecedentes Obstétricos
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.numero_gestas.id_for_label }}" class="form-label">
                                    {{ form.numero_gestas.label }}
                                </label>
                                {{ form.numero_gestas }}
                                {% if form.numero_gestas.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.numero_gestas.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.numero_partos.id_for_label }}" class="form-label">
                                    {{ form.numero_partos.label }}
                                </label>
                                {{ form.numero_partos }}
                                {% if form.numero_partos.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.numero_partos.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.numero_abortos.id_for_label }}" class="form-label">
                                    {{ form.numero_abortos.label }}
                                </label>
                                {{ form.numero_abortos }}
                                {% if form.numero_abortos.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.numero_abortos.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.hijos_vivos.id_for_label }}" class="form-label">
                                    {{ form.hijos_vivos.label }}
                                </label>
                                {{ form.hijos_vivos }}
                                {% if form.hijos_vivos.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.hijos_vivos.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.partos_vaginales.id_for_label }}" class="form-label">
                                    {{ form.partos_vaginales.label }}
                                </label>
                                {{ form.partos_vaginales }}
                                {% if form.partos_vaginales.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.partos_vaginales.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.partos_cesareas.id_for_label }}" class="form-label">
                                    {{ form.partos_cesareas.label }}
                                </label>
                                {{ form.partos_cesareas }}
                                {% if form.partos_cesareas.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.partos_cesareas.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Datos del Embarazo Actual -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar-heart"></i> Datos del Embarazo Actual
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.fecha_ultima_regla.id_for_label }}" class="form-label">
                                    {{ form.fecha_ultima_regla.label }}
                                </label>
                                {{ form.fecha_ultima_regla }}
                                {% if form.fecha_ultima_regla.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.fecha_ultima_regla.errors }}
                                    </div>
                                {% endif %}
                                <small class="text-muted">{{ form.fecha_ultima_regla.help_text }}</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.fecha_probable_parto.id_for_label }}" class="form-label">
                                    {{ form.fecha_probable_parto.label }}
                                </label>
                                {{ form.fecha_probable_parto }}
                                {% if form.fecha_probable_parto.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.fecha_probable_parto.errors }}
                                    </div>
                                {% endif %}
                                <small class="text-muted">{{ form.fecha_probable_parto.help_text }}</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Edad Gestacional</label>
                                <div class="row">
                                    <div class="col-6">
                                        <label for="{{ form.edad_gestacional_semanas.id_for_label }}" class="form-label small">
                                            {{ form.edad_gestacional_semanas.label }}
                                        </label>
                                        {{ form.edad_gestacional_semanas }}
                                        {% if form.edad_gestacional_semanas.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.edad_gestacional_semanas.errors }}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-6">
                                        <label for="{{ form.edad_gestacional_dias.id_for_label }}" class="form-label small">
                                            {{ form.edad_gestacional_dias.label }}
                                        </label>
                                        {{ form.edad_gestacional_dias }}
                                        {% if form.edad_gestacional_dias.errors %}
                                            <div class="invalid-feedback d-block">
                                                {{ form.edad_gestacional_dias.errors }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.peso_actual.id_for_label }}" class="form-label">
                                    {{ form.peso_actual.label }}
                                </label>
                                {{ form.peso_actual }}
                                {% if form.peso_actual.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.peso_actual.errors }}
                                    </div>
                                {% endif %}
                                <small class="text-muted">{{ form.peso_actual.help_text }}</small>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="{{ form.talla.id_for_label }}" class="form-label">
                                    {{ form.talla.label }}
                                </label>
                                {{ form.talla }}
                                {% if form.talla.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.talla.errors }}
                                    </div>
                                {% endif %}
                                <small class="text-muted">{{ form.talla.help_text }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Patologías -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-heart-pulse-fill"></i> Patologías Asociadas
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">{{ form.patologias.label }}</label>
                            {{ form.patologias }}
                            {% if form.patologias.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.patologias.errors }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.descripcion_patologias.id_for_label }}" class="form-label">
                                {{ form.descripcion_patologias.label }}
                            </label>
                            {{ form.descripcion_patologias }}
                            {% if form.descripcion_patologias.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.descripcion_patologias.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Observaciones y Antecedentes -->
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-journal-text"></i> Observaciones y Antecedentes
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.observaciones_generales.id_for_label }}" class="form-label">
                                {{ form.observaciones_generales.label }}
                            </label>
                            {{ form.observaciones_generales }}
                            {% if form.observaciones_generales.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.observaciones_generales.errors }}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.antecedentes_relevantes.id_for_label }}" class="form-label">
                                {{ form.antecedentes_relevantes.label }}
                            </label>
                            {{ form.antecedentes_relevantes }}
                            {% if form.antecedentes_relevantes.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.antecedentes_relevantes.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Botones -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
                    <a href="{% url 'matrona:seleccionar_paciente_ficha' %}" class="btn btn-secondary btn-lg">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </a>
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="bi bi-save"></i> Crear Ficha Obstétrica
                    </button>
                </div>
            </form>
            
            <!-- Nota informativa -->
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i>
                <strong>Nota:</strong> Los campos marcados con <span class="text-danger">*</span> son obligatorios. 
                El número de ficha se generará automáticamente al guardar.
            </div>
            
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .form-check-input {
        margin-right: 0.5rem;
    }
    
    .form-label {
        font-weight: 500;
    }
    
    .card-header h5 {
        margin-bottom: 0;
    }
</style>
{% endblock %}