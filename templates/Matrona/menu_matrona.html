{% extends 'Shared/base.html' %}
{% load static %}

{% block title %}M√≥dulo Matrona - Sistema Obst√©trico{% endblock %}

{% block content %}
<div class="container mt-4">
    
    <!-- Encabezado Principal -->
    <div class="text-center mb-5">
        <h1 class="display-4">
            <i class="bi bi-hospital text-primary"></i>
            M√≥dulo de Matrona
        </h1>
        <p class="lead text-muted">
            Sistema Integral de Gesti√≥n Obst√©trica
        </p>
        <hr class="my-4">
    </div>

    <!-- Mensaje de Bienvenida -->
    {% if user.is_authenticated %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <h5 class="alert-heading">
            <i class="bi bi-emoji-smile"></i> 
            Bienvenida, {{ user.get_full_name|default:user.username }}
        </h5>
        <p class="mb-0">
            <i class="bi bi-calendar-event"></i> 
            <strong>Fecha:</strong> {% now "l, d \d\e F \d\e Y" %}
            &nbsp;|&nbsp;
            <i class="bi bi-clock"></i> 
            <strong>Hora:</strong> {% now "H:i" %}
        </p>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- Estad√≠sticas R√°pidas -->
    <div class="row mb-5">
        <div class="col-md-3 mb-3">
            <div class="card text-center border-primary shadow-sm h-100">
                <div class="card-body">
                    <i class="bi bi-people-fill text-primary" style="font-size: 3rem;"></i>
                    <h2 class="mt-3 mb-0 text-primary">{{ total_pacientes|default:0 }}</h2>
                    <p class="text-muted mb-0">Pacientes Activos</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center border-success shadow-sm h-100">
                <div class="card-body">
                    <i class="bi bi-file-medical-fill text-success" style="font-size: 3rem;"></i>
                    <h2 class="mt-3 mb-0 text-success">{{ total_fichas_activas|default:0 }}</h2>
                    <p class="text-muted mb-0">Fichas Activas</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center border-warning shadow-sm h-100">
                <div class="card-body">
                    <i class="bi bi-hospital text-warning" style="font-size: 3rem;"></i>
                    <h2 class="mt-3 mb-0 text-warning">{{ ingresos_activos|default:0 }}</h2>
                    <p class="text-muted mb-0">Ingresos Activos</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-center border-info shadow-sm h-100">
                <div class="card-body">
                    <i class="bi bi-capsule text-info" style="font-size: 3rem;"></i>
                    <h2 class="mt-3 mb-0 text-info">{{ medicamentos_activos|default:0 }}</h2>
                    <p class="text-muted mb-0">Tratamientos Activos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Accesos R√°pidos Principales -->
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-3">
                <i class="bi bi-lightning-charge text-warning"></i> 
                Accesos R√°pidos
            </h3>
        </div>
    </div>

    <div class="row g-4 mb-5">
        
        <!-- B√öSQUEDA DE PACIENTES -->
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-primary card-hover">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-search"></i> Buscar Paciente
                    </h5>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text flex-grow-1">
                        Buscar pacientes por RUT o nombre para ver su informaci√≥n, fichas y tratamientos.
                    </p>
                    <div class="d-grid">
                        <a href="{% url 'matrona:buscar_paciente' %}" class="btn btn-primary">
                            <i class="bi bi-search"></i> Buscar Ahora
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- REGISTRAR PACIENTE -->
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-success card-hover">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-plus-fill"></i> Registrar Paciente
                    </h5>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text flex-grow-1">
                        Registrar una nueva paciente en el sistema con todos sus datos personales y m√©dicos.
                    </p>
                    <div class="d-grid">
                        <a href="{% url 'matrona:registrar_paciente' %}" class="btn btn-success">
                            <i class="bi bi-plus-circle"></i> Registrar Nuevo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CREAR FICHA OBST√âTRICA -->
        <div class="col-md-4">
            <div class="card h-100 shadow-sm border-info card-hover">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-file-earmark-medical"></i> Nueva Ficha Obst√©trica
                    </h5>
                </div>
                <div class="card-body d-flex flex-column">
                    <p class="card-text flex-grow-1">
                        Crear una nueva ficha obst√©trica para seguimiento de embarazo y control prenatal.
                    </p>
                    <div class="d-grid">
                        <a href="{% url 'matrona:seleccionar_paciente_ficha' %}" class="btn btn-info">
                            <i class="bi bi-file-earmark-plus"></i> Crear Ficha
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gesti√≥n de Pacientes y Fichas -->
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-3">
                <i class="bi bi-folder2-open text-primary"></i> 
                Gesti√≥n de Pacientes y Fichas
            </h3>
        </div>
    </div>

    <div class="row g-4 mb-5">
        
        <!-- LISTAR PACIENTES -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-primary card-hover">
                <div class="card-header bg-light">
                    <h5 class="mb-0 text-primary">
                        <i class="bi bi-list-ul"></i> Listar Pacientes
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Ver el listado completo de todas las pacientes registradas en el sistema.
                    </p>
                    <ul class="mb-3">
                        <li>Ver datos personales</li>
                        <li>Acceder a fichas obst√©tricas</li>
                        <li>Historial de ingresos</li>
                        <li>Estado de tratamientos</li>
                    </ul>
                    <div class="d-grid">
                        <a href="{% url 'matrona:lista_pacientes' %}" class="btn btn-outline-primary">
                            <i class="bi bi-list-ul"></i> Ver Listado
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- TODAS LAS FICHAS -->
        <div class="col-md-6">
            <div class="card h-100 shadow-sm border-success card-hover">
                <div class="card-header bg-light">
                    <h5 class="mb-0 text-success">
                        <i class="bi bi-folder-fill"></i> Todas las Fichas
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Acceder a todas las fichas obst√©tricas del sistema con b√∫squeda y filtros.
                    </p>
                    <ul class="mb-3">
                        <li>Fichas activas y cerradas</li>
                        <li>Filtrar por fecha</li>
                        <li>Buscar por paciente</li>
                        <li>Ver medicamentos asignados</li>
                    </ul>
                    <div class="d-grid">
                        <a href="{% url 'matrona:todas_fichas' %}" class="btn btn-outline-success">
                            <i class="bi bi-folder2-open"></i> Ver Fichas
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gesti√≥n de Ingresos -->
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-3">
                <i class="bi bi-hospital text-warning"></i> 
                Gesti√≥n de Ingresos Hospitalarios
            </h3>
        </div>
    </div>

    <div class="row g-4 mb-5">
        
        <!-- REGISTRAR INGRESO -->
        <div class="col-md-12">
            <div class="card h-100 shadow-sm border-warning card-hover">
                <div class="card-header bg-light">
                    <h5 class="mb-0 text-warning">
                        <i class="bi bi-hospital"></i> Registrar Ingreso Hospitalario
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Registrar el ingreso hospitalario de una paciente al sistema.
                    </p>
                    <ul class="mb-3">
                        <li>Registrar nuevos ingresos</li>
                        <li>Asociar a ficha obst√©trica</li>
                        <li>Motivo y diagn√≥stico de ingreso</li>
                        <li>Informaci√≥n de emergencia</li>
                    </ul>
                    <div class="d-grid">
                        <a href="{% url 'matrona:registrar_ingreso' %}" class="btn btn-outline-warning">
                            <i class="bi bi-building"></i> Registrar Ingreso
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Informaci√≥n del Sistema -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-question-circle"></i> Ayuda y Recursos
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6><i class="bi bi-book"></i> Documentaci√≥n</h6>
                            <p class="small">Consulte el manual de usuario para instrucciones detalladas.</p>
                            <a href="#" class="btn btn-sm btn-outline-info" disabled>
                                <i class="bi bi-file-text"></i> Pr√≥ximamente
                            </a>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-play-circle"></i> Tutoriales</h6>
                            <p class="small">Videos explicativos sobre el uso del sistema.</p>
                            <a href="#" class="btn btn-sm btn-outline-info" disabled>
                                <i class="bi bi-camera-video"></i> Pr√≥ximamente
                            </a>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-headset"></i> Soporte T√©cnico</h6>
                            <p class="small">¬øNecesita ayuda? Contacte al equipo de soporte.</p>
                            <a href="#" class="btn btn-sm btn-outline-info" disabled>
                                <i class="bi bi-envelope"></i> Pr√≥ximamente
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot√≥n Volver -->
    <div class="text-center mb-5">
        <a href="{% url 'home' %}" class="btn btn-secondary btn-lg">
            <i class="bi bi-arrow-left-circle"></i> Volver al Inicio
        </a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .card-hover {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .card-hover:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15) !important;
    }
    
    .card-body i[style*="font-size: 3rem"] {
        transition: transform 0.3s ease;
    }
    
    .card:hover i[style*="font-size: 3rem"] {
        transform: scale(1.1);
    }
    
    .card h2 {
        font-weight: 700;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .card {
        animation: fadeInUp 0.5s ease;
    }
    
    hr.my-4 {
        border-top: 3px solid #007bff;
        opacity: 0.5;
        width: 60%;
        margin: 2rem auto;
    }
    
    .card-body ul {
        padding-left: 1.2rem;
    }
    
    .card-body ul li {
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
    }
    
    @media (max-width: 768px) {
        .display-4 {
            font-size: 2rem;
        }
        
        .card-body i[style*="font-size: 3rem"] {
            font-size: 2rem !important;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
// Actualizar hora en tiempo real
function actualizarHora() {
    const ahora = new Date();
    const opciones = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
    const horaActual = ahora.toLocaleTimeString('es-CL', opciones);
    
    const elementoHora = document.querySelector('.alert-info p');
    if (elementoHora) {
        const textoOriginal = elementoHora.innerHTML;
        const nuevoTexto = textoOriginal.replace(/\d{2}:\d{2}(:\d{2})?/, horaActual);
        elementoHora.innerHTML = nuevoTexto;
    }
}

setInterval(actualizarHora, 1000);

// Efecto de clic en tarjetas
document.querySelectorAll('.card-hover').forEach(card => {
    card.addEventListener('click', function(e) {
        if (!e.target.closest('a')) {
            const link = this.querySelector('a.btn');
            if (link) {
                link.click();
            }
        }
    });
});

// Animaci√≥n de contador para estad√≠sticas
function animarContadores() {
    document.querySelectorAll('.card h2').forEach(elemento => {
        const valorFinal = parseInt(elemento.textContent) || 0;
        let valorActual = 0;
        const incremento = Math.ceil(valorFinal / 50);
        
        const timer = setInterval(() => {
            valorActual += incremento;
            if (valorActual >= valorFinal) {
                elemento.textContent = valorFinal;
                clearInterval(timer);
            } else {
                elemento.textContent = valorActual;
            }
        }, 30);
    });
}

document.addEventListener('DOMContentLoaded', animarContadores);

console.log('‚úÖ Men√∫ de Matrona cargado correctamente');
console.log('üìä Estad√≠sticas:', {
    pacientes: {{ total_pacientes|default:0 }},
    fichas: {{ total_fichas_activas|default:0 }},
    ingresos: {{ ingresos_activos|default:0 }},
    medicamentos: {{ medicamentos_activos|default:0 }}
});
</script>
{% endblock %}